
// Model Section
var Bnums = [
  {
    "num": "B­-402",
    "description": "Fake Sign Material Example",
    "type": "Sign",
    "material": "Polyester",
    "finish": "Matte",
    "adhesive": "Acrylic",
    "thickness": ".0001 in",
    "longdescription": "B-402 is a thermal transfer printable metallized polyester label stock designed for applications, like rating and serial plates, that utilize barcodes, alphanumerics, graphic symbols and logos and require nameplate-like quality.",
    "specialproperties": ["Cold Resistant", "Heat Resistant", "Flame Retardent", "Removable"],
    "compliance": ["UL"],
    "applications": ["Electrical", "Lean", "Datacomm"],
    "colors": ["white"],
    "tapecolorable": "yes",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },
      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  },
  {
    "num": "B­-744",
    "description": "Fake Selflam Material Example",
    "type": "Selflam",
    "material": "Polyester",
    "finish": "Matte",
    "adhesive": "Acrylic",
    "thickness": ".0001 in",
    "longdescription": "B-402 is a thermal transfer printable metallized polyester label stock designed for applications, like rating and serial plates, that utilize barcodes, alphanumerics, graphic symbols and logos and require nameplate-like quality.",
    "specialproperties": ["Cold Resistant", "Heat Resistant", "Flame Retardent", "Removable"],
    "compliance": ["UL"],
    "applications": ["Electrical", "Lean", "Datacomm"],
    "colors": ["white"],
    "tapecolorable": "yes",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },
      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  },
  {
    "num": "B­-902",
    "description": "Fake Wiremarker Material Example",
    "type": "Wiremarker",
    "material": "Polyester",
    "finish": "Matte",
    "adhesive": "Acrylic",
    "thickness": ".0001 in",
    "longdescription": "B-402 is a thermal transfer printable metallized polyester label stock designed for applications, like rating and serial plates, that utilize barcodes, alphanumerics, graphic symbols and logos and require nameplate-like quality.",
    "specialproperties": ["Cold Resistant", "Heat Resistant", "Flame Retardent", "Removable"],
    "compliance": ["UL"],
    "applications": ["Electrical", "Lean", "Datacomm"],
    "colors": ["white"],
    "tapecolorable": "yes",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },
      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  },
  {
    "num": "B­-459",
    "description": "Fake Tag Material Example",
    "type": "Tag",    
    "material": "Vinyl",
    "finish": "Gloss",
    "adhesive": "Acrylic",
    "thickness": ".0006 in",
    "longdescription": "B-459 is another very great material from Brady Corporation. It has a number of unique properties, blah, blah, blah.",
    "specialproperties": ["Flame Retardent", "Heat Resistant", "Removable", "Cold Resistant"],
    "compliance": ["UL", "ROHS"],
    "applications": ["Electrical", "Lab", "Safety"],
    "colors": ["green", "red", "brown"],
    "tapecolorable": "yes",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },
      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  },
  {
    "num": "B­-595",
    "description": "Fake Sleeve Material Example",
    "type": "Sleeve",
    "material": "Polyester",
    "finish": "Gloss",
    "adhesive": "Acrylic",
    "thickness": ".0025 in",
    "longdescription": "B-202. Wow, this ia great material. I really can't express adequately how great this material is, blah, blah, blah.",
    "specialproperties": ["Cold Resistant", "Removable", "Flame Retardent"],
    "compliance": ["UL", "CSA", "ROHS"],
    "applications": ["Wire & Cable", "Lab", "Hazardous Materials"],
    "colors": ["blue", "yellow", "brown", "white"],
    "tapecolorable": "yes",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  },

  {
    "num": "B­-259",
    "description": "Fake Label Material Example",
    "type": "Label",
    "material": "Paper",
    "finish": "Gloss",
    "adhesive": "Glue",
    "thickness": ".0034 in",
    "longdescription": "B-259. Ok, tbh, this is not our best material. In fact, it pains me slightly to even mentioned it. Let's maybe move on to the next material.",
    "specialproperties": ["Flame Retardent", "Removable"],
    "compliance": ["UL", "CSA", "ROHS"],
    "applications": ["Wire & Cable", "Lean", "Safety", "LOTO"],
    "colors": ["blue", "yellow", "orange", "white", "clear", "green", "purple"],
    "tapecolorable": "no",
    "chemresistance": [
      {
        "category": "Fuels",
        "rating": "Good"
      },
      {
        "category": "Oils",
        "rating": "Poor"
      },
      {
        "category": "Solvents",
        "rating": "Good"
      },      {
        "category": "Cleaners",
        "rating": "Bad"
      }
    ],
    "adhesion": [
      {
        "category": "Steel",
        "rating": "Good"
      },
      {
        "category": "Powder Coated Metal",
        "rating": "Poor"
      },
      {
        "category": "Polypropylene",
        "rating": "Good"
      },      {
        "category": "Textured ABS",
        "rating": "Bad"
      }
    ]
  }
];

var Filters = [
  {
    "id": "type",
    "displayname": "Material Type",
    "presentation": "Checkbox", // not used as of yet
    "values": []
  },
  {
    "id": "applications",
    "displayname": "Applications",
    "presentation": "Checkbox", // not used as of yet
    "values": []
  },
  {
    "id": "material",
    "displayname": "Material",
    "presentation": "Checkbox", // not used as of yet
    "values": []
  },
  {
    "id": "finish",
    "displayname": "Finish",
    "presentation": "Checkbox", // not used as of yet
    "values": []
  },
  {
    "id": "colors",
    "displayname": "Colors",
    "presentation": "Swatch", // not used as of yet
    "values": []
  }
];


// Controller
var app = angular.module('MaterialApp', []);

app.controller('MaterialCtrl', function($scope, $filter) {
  // Define a variable to hold the complete list of all B#s in the model
  $scope.AllBnums = Bnums;
  // Define a variable to hold the filtered list of B#s that get displayed in the table
  $scope.Bnum = Bnums;
  // Define a variable to hold a list of all attributes that will be used for filtering along with their values
  $scope.Filters = Filters;
  // define an variable to hold the list applied filters
  $scope.setFilters = [];


  $scope.init = function () {
    // Setup filters and values
    $scope.capturefilters();
    // Sort the B# list alphabetically by B# name
    $scope.sortBnums();
  };

  $scope.capturefilters = function() {
    // Build an array of all the possible filtering values to populate the dropdowns with the possible values from the data
    // Loop through all the Bnums looking for each filter. 
    // Collect the possible values for each filter and adds them to the Filters array. 
    // Differentiate between Bnum properties that have one or more values (arrays)

    // Loop across the Filters array
    for(var i=0; i < Filters.length; i++){
      // take the id from each Filter to find the values in the Bnum data
      var currentfilterid = Filters[i].id;
      // loop across Bnums looking for at the current filter and adding the value from the B# into the Filters.values array
      for(var j=0; j < $scope.Bnum.length; j++) {
        //check to see if the filter is an array (can have multiple values)
        //if not, its easier
        if (!Array.isArray($scope.Bnum[j][currentfilterid])) {
          //check to see if the value is already in the values array. 
          var pos = Filters[i].values.map(function(e) { return e.id; }).indexOf($scope.Bnum[j][currentfilterid]);
          if (pos == -1) { 
            // not already there so add to the filter array
            Filters[i].values.push(
            {
              "id": $scope.Bnum[j][currentfilterid],
              "applied": false
            });
          };
        // if it is an array, we need to parse through the array for each value
        } else {
          //loop through the values in the Bnum property
          for(var k=0; k < $scope.Bnum[j][currentfilterid].length; k++) {
            //check to see if the value is already in the values array. 
            //
            var pos = Filters[i].values.map(function(e) { return e.id; }).indexOf($scope.Bnum[j][currentfilterid][k]);
            if (pos == -1) { 
            // not already there so add it        
              Filters[i].values.push({
                "id": $scope.Bnum[j][currentfilterid][k],
                "applied": false
              });
            };
          };
        };
      };
      // Sort filters so they are presented alphabetically
      Filters[i].values.sort();
    };
  };

  // Update the B# list shown to the user
  $scope.updateTable = function() {
    // create a temporary B# list of all B#s to filter down
    var TempBnums = $scope.AllBnums;
    // call the function to filter the temp full B# list by the setFilters list
    for(var i=0; i < $scope.setFilters.length; i++) {
      // loop through the list of attribute/value pairs filter TempBnums repeatedly for each pair
        var temp1 = $scope.setFilters[i].FilterId;
        var temp2 = $scope.setFilters[i].FilterValue;
        var TempBnums = $filter('filter')(TempBnums, { [temp1]: temp2 });
    };    
    // reset the Bnum list to the new filtered list of Bnums
    $scope.Bnum = TempBnums;
    // reassess possible filter values and gray them out in the input controls
  };

  // Toggle checked filters on/off and remove from the set filters stage if needed
  $scope.toggleFilter = function(position, filterId, filterValue) {
    // take the inputs to create a attribute/value pair identifying the attribute and its set value
    attrvaluepair = {
      "Position": position,
      "FilterId": filterId.id,
      "FilterValue": filterValue.id
    };
    //Find the position of the filter value in the values array for the filter
    var valueposition = Filters[position].values.map(function(e) { return e.id; }).indexOf(filterValue.id);
    // Determine if the filter is checked or not and act accordingly
    // If it is checked, uncheck it and remove from the setFilters array
    if (filterValue.applied) {
      // Set the value of the 'applied' attribute to "false" so it will appear unchecked
      $scope.Filters[position].values[valueposition].applied = false;
      // Call the removeFilter function to remove the filter from the setFilters array/stage
      $scope.removeFilter(position, filterId.id, filterValue.id);
    // if not checked, then check it and add the setFilters array
    } else {
      // Add the attribute/value pair to the array of set filters 
      $scope.setFilters.push(attrvaluepair);
      // Set the value of the 'applied' attribute to "true" so it will appear checked
      $scope.Filters[position].values[valueposition].applied = true;
    };

    // Refilter the B# table using the updated setFilters array 
    $scope.updateTable();
  };

  // Remove a filter from the setfilters stage
  $scope.removeFilter = function(position, filterId, filterValue) {
    // Loop through setFilters array looking for the filter valuepair
    for( var i = 0; i < $scope.setFilters.length; i++){ 
       if (($scope.setFilters[i].FilterId == filterId) && ($scope.setFilters[i].FilterValue == filterValue)) {
         // Update the Filters value applied property to "false"
         // - Find the setfilter in the Filters array
         var valueposition = Filters[position].values.map(function(e) { return e.id; }).indexOf(filterValue);
         $scope.Filters[position].values[valueposition].applied = false;
         // Remove the filter from the setFilters array
         $scope.setFilters.splice(i, 1); 
       };
    };
    $scope.updateTable();
  };

  // Sort the list of Bnums
  $scope.sortBnums = function() {
    // Sort the Bnum list by the num property so it is presented in alpha/numeric order
    Bnums.sort(function(a, b){
      var numA=a.num.toLowerCase(), numB=b.num.toLowerCase()
      if (numA < numB) //sort string ascending
          return -1 
      if (numA > numB)
          return 1
      return 0 //default return value (no sorting)
    });
  }

  $scope.init();

});










